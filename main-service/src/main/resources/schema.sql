
CREATE TABLE IF NOT EXISTS USERS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  NAME VARCHAR(250) NOT NULL,
  EMAIL VARCHAR(254) NOT NULL,
  CONSTRAINT PK_USER PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS CATEGORIES (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  CATEGORY_NAME VARCHAR(500) NOT NULL,
  CONSTRAINT PK_CATEGORIES PRIMARY KEY (ID),
  CONSTRAINT UQ_CATEGORY_NAME UNIQUE (CATEGORY_NAME)
);

CREATE TABLE IF NOT EXISTS LOCATION (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  LONGITUDE REAL NOT NULL,
  LATITUDE REAL NOT NULL,
  CONSTRAINT PK_LOCATIONS PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS EVENTS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  ANNOTATION VARCHAR(2000) NOT NULL,
  CREATED TIMESTAMP WITHOUT TIME ZONE,
  PUBLISHED TIMESTAMP WITHOUT TIME ZONE,
  DESCRIPTION VARCHAR(7000),
  EVENT_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  PAID BOOLEAN,
  PARTICIPANT_LIMIT INT,
  REQUEST_MODERATION BOOLEAN,
  TITLE VARCHAR(120)  NOT NULL,
  EVENT_STATE VARCHAR(50),

  CATEGORY_ID BIGINT NOT NULL,
  INITIATOR_ID BIGINT NOT NULL,
  LOCATION_ID BIGINT NOT NULL,

  CONSTRAINT PK_EVENTS PRIMARY KEY (ID),
  CONSTRAINT FK_EVENTS_CATEGORIES FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES(ID) ON DELETE CASCADE,
  CONSTRAINT FK_EVENTS_INITIATOR FOREIGN KEY (INITIATOR_ID) REFERENCES USERS(ID) ON DELETE CASCADE,
  CONSTRAINT FK_EVENTS_LOCATION FOREIGN KEY (LOCATION_ID) REFERENCES LOCATION(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS REQUESTS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  CREATED TIMESTAMP WITHOUT TIME ZONE,
  REQUESTER_ID BIGINT NOT NULL,
  EVENT_ID BIGINT NOT NULL,
  STATUS VARCHAR(50),

  CONSTRAINT PK_REQUESTS PRIMARY KEY (ID),
  CONSTRAINT FK_REQUESTS_USER FOREIGN KEY (REQUESTER_ID) REFERENCES USERS(ID) ON DELETE CASCADE,
  CONSTRAINT FK_REQUESTS_EVENT FOREIGN KEY (EVENT_ID) REFERENCES EVENTS(ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS COMPILATIONS (
  ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
  PINNED BOOLEAN,
  TITLE VARCHAR(50),

  CONSTRAINT PK_COMPILATIONS PRIMARY KEY (ID),
  CONSTRAINT UQ_TITLE UNIQUE (TITLE)
);

CREATE TABLE IF NOT EXISTS EVENTS_COMPILATIONS (
  COMPILATION_ID BIGINT,
  EVENT_ID BIGINT,

  CONSTRAINT FK_COMPILATION_ID FOREIGN KEY (COMPILATION_ID) REFERENCES COMPILATIONS (ID) ON DELETE CASCADE,
  CONSTRAINT FK_COMPILATION_EVENT FOREIGN KEY (EVENT_ID) REFERENCES EVENTS (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS COMMENTS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  TEXT VARCHAR(252) NOT NULL,
  EVENT_ID BIGINT NOT NULL,
  AUTHOR_ID BIGINT NOT NULL,
  CREATED TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  REACTION VARCHAR(10),
  PROPOSAL VARCHAR(500),
  STATE VARCHAR(10),
  IS_TOXIC BOOLEAN,
  CONSTRAINT UQ_COMMENTS_TEXT UNIQUE (TEXT, AUTHOR_ID, EVENT_ID),

  CONSTRAINT PK_COMMENTS PRIMARY KEY (ID),

  CONSTRAINT FK_COMMENTS_EVENT FOREIGN KEY (EVENT_ID) REFERENCES EVENTS(ID) ON DELETE CASCADE,
  CONSTRAINT FK_COMMENTS_USER FOREIGN KEY (AUTHOR_ID) REFERENCES USERS(ID) ON DELETE CASCADE
);